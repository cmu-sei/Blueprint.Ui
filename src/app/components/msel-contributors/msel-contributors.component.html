<!--
Copyright 2024 Carnegie Mellon University. All Rights Reserved.
Released under a MIT (SEI)-style license, please see LICENSE.md in the
project root for license information or contact permission@sei.cmu.edu for full terms.
-->
@if (msel) {
  <div class="scrolling-region">
    <div class="mat-elevation-z2 section-container">
      <div class="section-content">
        @for (mselUnit of mselUnitList; track trackByFn($index, mselUnit)) {
          <mat-expansion-panel
            >
            <mat-expansion-panel-header
              (click)="$event.stopPropagation();"
              >
              @if (isContentDeveloper || msel.hasRole(loggedInUserId, null).owner) {
                <button
                  mat-icon-button
                  (click)="removeUnitFromMsel(mselUnit.id); $event.stopPropagation();"
                  title="Remove unit from MSEL"
                  >
                  <mat-icon class="mdi-24px self-center" fontIcon="mdi-minus-circle-outline"></mat-icon>
                </button>
              }
              <span class="center-self">{{ getUnit(mselUnit.unitId).shortName }} - {{ getUnit(mselUnit.unitId).name }}</span>
            </mat-expansion-panel-header>
            @for (user of getMselUnitUsers(mselUnit.unitId); track user) {
              <div class="unit-detail">
                <div class="user-name four-cell">{{ user.name }}</div>
                @for (mselRole of getMselRolesToDisplay(); track mselRole) {
                  <div class="msel-role one-cell">
                    <mat-checkbox
                      [checked]="hasMselRole(user.id, mselRole)"
                      (change)="toggleMselRole(user.id, mselRole, $event.checked)"
                      (click)="$event.stopPropagation();"
                      style="margin-right: 20px;"
                      [disabled]="!isContentDeveloper && !msel.hasRole(loggedInUserId, null).owner"
                      [matTooltip]="getRoleDescription(mselRole)"
                      >{{ mselRole }}</mat-checkbox
                      >
                    </div>
                  }
                </div>
              }
              @if (getMselUnitUsers(mselUnit.unitId).length === 0) {
                <div class="unit-detail">This unit has no users.</div>
              }
            </mat-expansion-panel>
          }
        </div>
      </div>
      @if (isContentDeveloper || msel.hasRole(loggedInUserId, null).owner) {
        <div class="mat-elevation-z2 section-container">
          <div class="section-content">
            <mat-expansion-panel>
              <mat-expansion-panel-header
                (click)="$event.stopPropagation();"
                >
                Add a Contributor Unit
              </mat-expansion-panel-header>
              @for (unit of getUnitList(); track unit) {
                <div class="other-units-div">
                  <button
                    mat-icon-button
                    (click)="addUnitToMsel(unit.id); $event.stopPropagation();"
                    title="Add unit to MSEL"
                    >
                    <mat-icon class="mdi-24px self-center" fontIcon="mdi-plus-circle-outline"></mat-icon>
                  </button>
                  {{ unit.shortName }} - {{ unit.name }}
                </div>
              }
            </mat-expansion-panel>
          </div>
        </div>
      }
    </div>
  }
